# Day 04 - 高效學習：如何學習和閱讀代碼


### 讀文檔還是讀代碼

[Code Tells You How, Comments Tell You Why](https://blog.codinghorror.com/code-tells-you-how-comments-tell-you-why/)

- 代碼： What, How & Details
- 文檔 / 書： What, How & Why

1. 如果想知道人為什麼要這麼搞，那麼應該去看書
    - 像 Effective C++、Code Complete、Design Pattern、Thinking in Java 等，看文檔
2. 如果要知道讓機器乾了什麼？那應該看代碼
    - 像 Linus 去看 zlib 的代碼來找性能問題

### 如何閱讀源代碼

閱讀代碼有以下幾點為前提：

- `基礎知識`: 相關的語言和基礎技術的知識
- `軟件功能`: 先要知道這個軟件完成的是什麼樣的功能，有哪些特性，哪些配置項。先要讀一遍用戶手冊，然後讓軟件跑起來，自己先用一下感受一下
- `相關文檔`: 讀一下相關的內部文檔，Readme 也好，Release Notes 也好，Design 也好，Wiki 也好，這些文檔可以讓明白整個軟件的方方面面。如果的軟件沒有文檔，那麼，只能指望這個軟件的原作者還在，而且他還樂於交流
- `代碼的組織結構`: 就是代碼目錄中每個目錄是什麼樣的功能，每個文檔是幹什麼的

如何閱讀代碼：

1. 接口抽象定義
    - 其描述了**代碼需要處理的數據結構或者業務實體，以及它們之間的關係**，理清楚這些關係是非常重要的
2. 模塊黏合層
    - 如中間件（middleware）、Promises 模式、回調（Callback）、代理委託、依賴注入等
3. 業務流程
    - 業務怎麼傳遞，一般需要搭配流程圖或者時序圖
4. 具體實現
    - 代碼邏輯
        - 業務邏輯
        - 控制邏輯
            - 只是用控制程序流轉的，不是業務邏輯。如：flag 之類的控制變量，多線程處理的代碼，異步控制的代碼，遠程通訊的代碼，對象序列化反序列化的代碼等
    - 錯誤處理
        - 根據二八原則，**20% 的代碼是正常的邏輯，80% 的代碼是在處理各種錯誤**，所以，在讀代碼的時候，完全可以把處理錯誤的代碼全部刪除掉，這樣就會留下比較乾淨和簡單的正常邏輯的代碼。排除干擾因素，可以更高效地讀代碼
    - 數據處理
        - 這些代碼通常冗長無聊，不是主要邏輯，可以不理
    - 重要算法
        - 核心，最有含金量部分
        - 如一些索引表的算法，全局唯一 ID 的算法、信息推薦的算法、統計算法、通讀算法（如 Gossip）等
    - 底層交互
5. 運行時調試
    - 很多時候，代碼只有運行起來後，才能知道具體發生了什麼事
    - 實際看一下代碼的運行過程，是瞭解代碼的一種很好的方式

## 小結

如果想了解思想、方法和原理：讀書和讀文檔會更有效率。

如果想知道具體細節：讀代碼。

閱讀代碼總結如下：

- 一般採用自頂向下，從總體到細節的剝洋蔥的讀法
- **畫圖是必要的方式**，程序流程圖，調用時序圖，模塊組織圖...
- **代碼邏輯歸一下類，排除雜音，主要邏輯才會更清楚**
- debug 跟蹤一下代碼是了解代碼在執行中發生了什麼的最好方式


此文章為3月Day04學習筆記，內容來源於極客時間[《左耳聽風》](https://time.geekbang.org/column/article/14380)