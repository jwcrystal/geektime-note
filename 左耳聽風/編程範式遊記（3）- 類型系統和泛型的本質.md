# 編程範式遊記（3）- 類型系統和泛型的本質

在編程世界中，我們需要處理好兩件事：
1. 編程語言中的類型問題
2. 對真實世界中業務代碼的抽象、重用和拼裝

## 類型系統

類型系統用於定義如何將編程語言中的數值和表達式歸類為許多不同的類型，以及如何操作這些類型，還有這些類型如何互相作用。類型可以確認一個值或者一組值，具有特定的意義和目的。

編程語言會有兩種類型:
- 內建類型，如 int、float 和 char 等
- 抽象類型，如 struct、class 和 function 等。

程序語言的類型系統主要提供如下的功能:
- **程序語言的安全性**: 使用類型可以讓編譯器偵測一些代碼的錯誤，例如：可以識別出一個錯誤無效的表達式，如` Hello, World + 3 `這樣的不同數據類型間操作的問題。強類型語言提供更多的安全性，但是並不能保證絕對的安全。
- **利於編譯器的優化**: 靜態類型語言的類型聲明，可以讓編譯器明確地知道程序員的意圖。因此，編譯器就可以利用這一信息做很多代碼優化工作。例如：如果我們指定一個類型是 int ，那麼編譯就知道，這個類型會以 4 個字節的倍數進行對齊，編譯器就可以非常有效地利用更有效率的機器指令。
- **代碼的可讀性**: 有類型的編程語言，可以讓代碼更易讀和更易維護，代碼的語義也更清楚，代碼模塊的接口（如函數）也更豐富和清楚。
- **抽象化**: 類型允許程序設計者對程序以較高層次的方式思考，而不是煩人的低層次實現。例如，我們使用整型或是浮點型來取代底層的字節實現，我們可以將字符串設計成一個值，而不是底層字節的數組。從高層上來說，類型可以用來定義不同模塊間的交互協議，比如函數的入參類型和返回類型，從而可以讓接口更有語義，而且不同的模塊數據交換更為直觀和易懂。

**類型帶來的問題就是我們作用於不同類型的代碼，雖然長得非常相似，但是由於類型的問題需要根據不同版本寫出不同的算法，如果要做到泛型，就需要涉及比較底層的玩法。**

每個語言都需要一個類型檢查系統:

- 靜態類型檢查是在編譯器進行語義分析時進行的。如果一個語言強制實行類型規則（即通常只允許以不丟失信息為前提的自動類型轉換），那麼稱此處理為**強類型**，反之稱為**弱類型**。
- 動態類型檢查系統更多的是在運行時期做動態類型標記和相關檢查。因此動態類型的語言必然要給出一堆諸如：is_array(), is_int(), is_string() 或是 typeof() 這樣的運行時類型檢查函數。

## 泛型本質

要瞭解泛型的本質，就需要瞭解類型的本質:
- **類型是對內存的一種抽象**。不同的類型，會有不同的內存佈局和內存分配的策略。
- 不同的類型，有不同的操作。所以，對於特定的類型，也有特定的一組操作。

泛型編程於 1985 年在論文 **Generic Programming** 中被這樣定義：
> Generic programming centers around the idea of abstracting from concrete, efficient algorithms to obtain generic algorithms that can be combined with different data representations to produce a wide variety of useful software.— Musser, David R.; Stepanov, Alexander A., Generic Programming

**屏蔽掉數據和操作數據的細節，讓算法更為通用，讓編程者更多地關注算法的結構，而不是在算法中處理不同的數據類型。**

## 小結

**類型系統的出現主要是對容許混亂的操作加上了嚴格的限制，以避免代碼以無效的數據使用方式編譯或運行**。例如，整數運算不可用於字符串；指針的操作不可用於整數上，等等。但是，類型的產生和限制，雖然對底層代碼來說是安全的，但是對於更高層次的抽象產生了些負面因素。比**如在 C++ 語言里，為了同時滿足靜態類型和抽象，就導致了模板技術的出現，帶來了語言的複雜性**。

**不同的語言在設計上都會做相應的取捨**，比如：C 語言偏向於讓程序員可以控制更多的底層細節，而 Java 和 Python 則讓程序員更多地關注業務功能的實現。而 C++ 則是兩者都想要，導致語言在設計上非常複雜。

文章 4 月 Day15 學習筆記，內容來源於極客時間 [《左耳聽風》](https://time.geekbang.org/column/article/2017)